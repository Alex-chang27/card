<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>七夕給妳的小小遊戲</title>
<meta name="theme-color" content="#0f1020" />
<style>
  :root{
    --bg:#0f1020;
    --txt:#ffffff;
    --btn:#ffb3c1;
    --btn-txt:#000000;
    --card:#ffffff;
    --card-txt:#000000;
  }
  *{box-sizing:border-box}
  body{ margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Arial,"Apple Color Emoji","Segoe UI Emoji";
        background:var(--bg); color:var(--txt); text-align:center; line-height:1.6; }
  header{ padding:24px 16px 8px }
  h1{ margin:0 0 8px; font-size: clamp(20px, 4vw, 28px); }
  main{ padding: 8px 16px 32px; max-width: 720px; margin: 0 auto; }

  .stage{ display:none; opacity:0; transform: translateY(8px); transition: opacity .28s ease, transform .28s ease; }
  .stage.active{ display:block; opacity:1; transform:none; }
  .q{ margin:24px 0 10px; font-size: clamp(18px, 3.5vw, 22px); }

  .btns{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center; }
  button{ margin:0; padding:10px 14px; border:none; border-radius:10px; background:var(--btn); color:var(--btn-txt);
          cursor:pointer; font-size:16px; transition: transform .05s ease, filter .15s ease; }
  button:hover{ filter:brightness(1.05) }
  button:active{ transform: translateY(1px) }
  button:focus-visible{ outline: 2px solid #fff; outline-offset: 2px; }
  button[type="button"]{ /* ensure form-free behavior */ }

  .progress{ margin:8px 0 18px; display:flex; gap:6px; justify-content:center; }
  .dot{ width:8px; height:8px; border-radius:50%; background:#ffffff33 }
  .dot.on{ background:#ffffffaa }

  .final-card{ background:var(--card); color:var(--card-txt); padding:20px; border-radius:12px; margin-top:20px; text-align:left; }
  .final-actions{ margin-top:14px; display:flex; gap:10px; flex-wrap:wrap }
  .replay{ background:#d1e9ff }
  .share{ background:#ffd6a5 }

  /* 小小彩屑容器 */
  .confetti{ pointer-events:none; position:fixed; inset:0; overflow:hidden; }
  .confetti span{ position:absolute; width:8px; height:12px; background:#fff; opacity:0; animation: fall 1500ms linear forwards; }
  @keyframes fall{
    0%{ transform: translateY(-10vh) rotate(0deg); opacity:1 }
    100%{ transform: translateY(110vh) rotate(540deg); opacity:0 }
  }

  /* 無障礙：偏好減少動效時，關閉動畫 */
  @media (prefers-reduced-motion: reduce){
    .stage{ transition:none }
    button{ transition:none }
    .confetti span{ animation: none }
  }
</style>
</head>
<body>
  <header>
    <h1 id="title">七夕小遊戲（我很用心做的！！）</h1>
  </header>

  <main role="main" aria-labelledby="title">
    <div class="progress" aria-hidden="true" id="progress"></div>

    <div id="stages" aria-live="polite">
      <section class="stage active" data-step="1">
        <p class="q">看到「七夕」，你第一個想到的是？</p>
        <div class="btns">
          <button type="button" data-next>浪漫的星空</button>
          <button type="button" data-next>甜甜的約會</button>
        </div>
      </section>

      <section class="stage" data-step="2">
        <p class="q">如果今晚收到一個小驚喜，你會想是？</p>
        <div class="btns">
          <button type="button" data-next>一杯喜歡的飲料</button>
          <button type="button" data-next>一張小卡片</button>
        </div>
      </section>

      <section class="stage" data-step="3">
        <p class="q">我們下次見面，最想一起做什麼？</p>
        <div class="btns">
          <button type="button" data-next>在海邊散步</button>
          <button type="button" data-next>吃好吃的</button>
        </div>
      </section>

      <section class="stage" data-step="4">
        <p class="q">最後一題：此刻腦海裡浮現的三個字？</p>
        <div class="btns">
          <button type="button" data-final>想你了</button>
          <button type="button" data-final>快見面</button>
        </div>
      </section>
    </div>

    <section id="final" hidden>
      <div class="final-card">
        <h2>七夕快樂 ✨</h2>
        <p>今天是個非常特別的日子，雖然現在我們不在同一個地方，但今天最想分享心情的人是妳。</p>
        <p>小小的心意先留在這，真正想說的話，等某一個特別的時刻再當面告訴妳~</p>
        <p>— 來自一個非常在乎你的人</p>

        <div class="final-actions">
          <button type="button" class="replay" id="replay">再玩一次</button>
          <button type="button" class="share" id="share">分享給妳（Web Share）</button>
        </div>
      </div>
    </section>
  </main>

  <div class="confetti" aria-hidden="true" id="confetti"></div>

<script>
(function(){
  let step = 1;
  const total = document.querySelectorAll('.stage').length;
  const stages = document.getElementById('stages');
  const final = document.getElementById('final');
  const progress = document.getElementById('progress');
  const confettiBox = document.getElementById('confetti');

  // 建立進度點
  function renderDots(){
    progress.innerHTML = '';
    for(let i=1;i<=total;i++){
      const d=document.createElement('div');
      d.className='dot' + (i===step?' on':'');
      progress.appendChild(d);
    }
  }
  renderDots();

  // 切換到下一步（含邊界保護）
  function goNext(){
    const curr = document.querySelector(`.stage[data-step="${step}"]`);
    if(curr){ curr.classList.remove('active'); }
    step = Math.min(step+1, total);
    const next = document.querySelector(`.stage[data-step="${step}"]`);
    if(next){ next.classList.add('active'); }
    renderDots();
  }

  // 顯示最終卡片
  function showFinal(){
    const curr = document.querySelector(`.stage[data-step="${step}"]`);
    if(curr){ curr.classList.remove('active'); }
    stages.setAttribute('aria-hidden','true');
    final.hidden = false;
    sprinkle();
  }

  // 事件委派：點擊
  stages.addEventListener('click', (e)=>{
    const t = e.target;
    if(t.matches('[data-next]')) goNext();
    if(t.matches('[data-final]')) showFinal();
  });

  // 鍵盤支援：數字 1 / 2 快選、Enter
  document.addEventListener('keydown', (e)=>{
    const active = document.querySelector('.stage.active');
    if(!active) return;
    const btns = active.querySelectorAll('button');
    if(e.key === '1' && btns[0]) btns[0].click();
    if(e.key === '2' && btns[1]) btns[1].click();
    if(e.key === 'Enter'){
      const focused = document.activeElement;
      if(focused && focused.tagName==='BUTTON') focused.click();
    }
  });

  // 再玩一次
  document.getElementById('replay').addEventListener('click', ()=>{
    final.hidden = true;
    stages.removeAttribute('aria-hidden');
    step = 1;
    document.querySelectorAll('.stage').forEach(s=>s.classList.remove('active'));
    document.querySelector(`.stage[data-step="1"]`).classList.add('active');
    renderDots();
    window.scrollTo({top:0, behavior:'smooth'});
  });

  // Web Share（可選）
  document.getElementById('share').addEventListener('click', async ()=>{
    const data = {
      title: '七夕給妳的小小遊戲',
      text: '送妳一個小小的七夕互動卡片 💖',
      url: location.href
    };
    if(navigator.share){
      try{ await navigator.share(data); }catch(_){}
    }else{
      // 後備：複製連結
      await navigator.clipboard.writeText(location.href);
      alert('已複製連結，貼給她吧！');
    }
  });

  // 簡單彩屑
  function sprinkle(){
    const n = 80;
    confettiBox.innerHTML = '';
    for(let i=0;i<n;i++){
      const s = document.createElement('span');
      s.style.left = Math.random()*100 + 'vw';
      s.style.top = (-10 - Math.random()*20) + 'vh';
      s.style.background = randomPastel();
      s.style.transform = `translateY(0) rotate(${Math.random()*360}deg)`;
      s.style.animationDelay = (Math.random()*0.6) + 's';
      s.style.animationDuration = (1100 + Math.random()*900) + 'ms';
      confettiBox.appendChild(s);
    }
    setTimeout(()=>{ confettiBox.innerHTML=''; }, 2200);
  }
  function randomPastel(){
    const h = Math.floor(Math.random()*360);
    return `hsl(${h} 100% 85%)`;
  }
})();
</script>
</body>
</html>